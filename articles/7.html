<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><title>GitHub Actionsでビルドを高速化したい！ | かたおかの雑談配信</title><meta name="description" content="かたおかです！ RibbonCMSではPythonとNPMを使っているのでビルド時の依存関係のインストールに時間がかかります。 記事投稿に毎回数分かかるとめんどうなのでどうにかキャッシュできないかをテストしてみます。  ## ビルド時間の短縮 GitHub ActionsでのCI/CDでは依存関係インストールがつきものです。 Pythonだと`pip`とか，フロントだと`npm`とか。 ただ，これ..."/><link rel="icon" href="https://ShotaroKataoka.github.io/static/images/favicon.ico"/><meta property="og:title" content="GitHub Actionsでビルドを高速化したい！ | かたおかの雑談配信"/><meta property="og:description" content="かたおかです！ RibbonCMSではPythonとNPMを使っているのでビルド時の依存関係のインストールに時間がかかります。 記事投稿に毎回数分かかるとめんどうなのでどうにかキャッシュできないかをテストしてみます。  ## ビルド時間の短縮 GitHub ActionsでのCI/CDでは依存関係インストールがつきものです。 Pythonだと`pip`とか，フロントだと`npm`とか。 ただ，これ..."/><meta property="og:image" content="https://ShotaroKataoka.github.io/static/images/thumbnail/7.jpg"/><meta property="og:type" content="article"/><meta property="og:site_name" content="かたおかの雑談配信"/><meta property="og:url" content="https://ShotaroKataoka.github.io/article/7"/><meta name="twitter:image" content="https://ShotaroKataoka.github.io/static/images/thumbnail/7.jpg"/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta name="next-head-count" content="14"/><meta name="theme-color" content="#1976d2"/><style data-emotion="css-global 1ii3po4">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-weight:400;font-size:1rem;line-height:1.5;background-color:#F0ECE0;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#F0ECE0;}</style><style data-emotion="css "></style><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/af16e0fa0c206764.css" as="style"/><link rel="stylesheet" href="/_next/static/css/af16e0fa0c206764.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6d54c7d60751f978.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6d54c7d60751f978.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-df4cf1c8d23aa877.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-82c12094935b23b2.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/563-dd2ef6f154fd9f09.js" defer=""></script><script src="/_next/static/chunks/121-ea82cf503e383d52.js" defer=""></script><script src="/_next/static/chunks/475-cb6e074afa978e65.js" defer=""></script><script src="/_next/static/chunks/219-8892efd382471043.js" defer=""></script><script src="/_next/static/chunks/359-6cf4c32ec6144182.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-c2ee7ae72f3ec5ba.js" defer=""></script><script src="/_next/static/57i90bc2xhNF_uFT2ZN-C/_buildManifest.js" defer=""></script><script src="/_next/static/57i90bc2xhNF_uFT2ZN-C/_ssgManifest.js" defer=""></script><script src="/_next/static/57i90bc2xhNF_uFT2ZN-C/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div><main><div><div><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation0 MuiAppBar-root MuiAppBar-colorInherit MuiAppBar-positionFixed mui-fixed css-10xzvcb"><div class="MuiContainer-root MuiContainer-maxWidthMd css-1c0cfyw"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-i6s8oy"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1bs1cg1" tabindex="0" type="button" aria-label="Open Sidebar"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10 css-1v3pb4k"><a class="MuiTypography-root MuiTypography-h3 css-vc39qc" href="/">かたおかの雑談配信</a></div></div></div></div></header></div><div class="MuiBox-root css-ebjf8f"></div></div><div class="MuiContainer-root MuiContainer-maxWidthMd css-1c0cfyw"><div><h1 class="MuiTypography-root MuiTypography-h1 MuiTypography-alignCenter css-1ewnmev">GitHub Actionsでビルドを高速化したい！</h1><p class="MuiTypography-root MuiTypography-body1 MuiTypography-alignCenter css-1a51bv2">2022年06月27日 20時43分<!-- -->に公開<!-- --></p><p class="MuiTypography-root MuiTypography-body1 MuiTypography-alignCenter css-1o3ep24">2022年06月28日 00時34分<!-- -->に更新<!-- --></p><div class="MuiBox-root css-yuob64"></div><div class="MuiBox-root css-9pqysf"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10.3 MuiGrid-grid-sm-11.3 css-1aeqyrk"><div class="MuiBox-root css-0"><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-14n541y" tabindex="0" href="/articles?tag=%E9%96%8B%E7%99%BA">開発<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-5mab4u" tabindex="0" href="/articles?tag=RibbonCMS">RibbonCMS<!-- --></a></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-1.7 MuiGrid-grid-sm-0.7 css-1bn5q8u"><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" href="https://github.com/ShotaroKataoka/ShotaroKataoka.github.io/issues/7" target="_blank" rel="noopener" aria-label="edit page"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall css-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="EditIcon"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></svg></a></div></div><div class="MuiBox-root css-yuob64"></div><div><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">かたおかです！<!-- --><br/>
RibbonCMSではPythonとNPMを使っているのでビルド時の依存関係のインストールに時間がかかります。<!-- --><br/>
記事投稿に毎回数分かかるとめんどうなのでどうにかキャッシュできないかをテストしてみます。<!-- --></div>
<!-- --><h2 id="ビルド時間の短縮"><div class="MuiBox-root css-174dpmb"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-0.5 css-1xsopoz"></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-1.5 css-1chpm7x"><a class="MuiTypography-root MuiTypography-h2 MuiLink-root MuiLink-underlineHover css-haf4zu" href="/articles/7#%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E9%96%93%E3%81%AE%E7%9F%AD%E7%B8%AE">##</a></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10 css-1v3pb4k"><div class="MuiTypography-root MuiTypography-h2 css-2hyyus">ビルド時間の短縮</div></div></div><hr class="MuiDivider-root MuiDivider-fullWidth MuiDivider-textAlignLeft css-ztfl0h"/></div></h2>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">GitHub ActionsでのCI/CDでは依存関係インストールがつきものです。<!-- --><br/>
Pythonだと<!-- --><div class="MuiBox-root css-dm2a2d">pip<!-- --></div>とか，フロントだと<!-- --><div class="MuiBox-root css-dm2a2d">npm<!-- --></div>とか。<!-- --><br/>
ただ，これのインストールって結構時間かかります。<!-- --><br/>
依存が大きいとインストールだけで数分とかかかってしまうので，頻繁に発動するActionsだとこれだけで大きな時間損失です。<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">RibbonCMSではビルドを2回行います。<!-- --><br/>
まず、Issueを<!-- --><div class="MuiBox-root css-dm2a2d">.json<!-- --></div>ファイルなどに変換するためのビルド（Issueビルドと呼んでます）です。<!-- --><br/>
これはPythonを用いて行っています。<!-- --><br/>
次に、Issueビルドで生成した結果をもとにしたフロント側のビルドです。<!-- --><br/>
これによりNext.jsを用いてhtmlなどを生成しています。<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">このような仕組みのため、RibbonCMSではPythonとNPMの両方のパッケージインストールを必要としています。<!-- --><br/>
記事投稿や編集のために毎回これをしているので，このインストール時間がかなりネックになってしまっている現状です。<!-- --></div>
<!-- --><h2 id="なんか失敗する．．"><div class="MuiBox-root css-174dpmb"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-0.5 css-1xsopoz"></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-1.5 css-1chpm7x"><a class="MuiTypography-root MuiTypography-h2 MuiLink-root MuiLink-underlineHover css-haf4zu" href="/articles/7#%E3%81%AA%E3%82%93%E3%81%8B%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B%EF%BC%8E%EF%BC%8E">##</a></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10 css-1v3pb4k"><div class="MuiTypography-root MuiTypography-h2 css-2hyyus">なんか失敗する．．</div></div></div><hr class="MuiDivider-root MuiDivider-fullWidth MuiDivider-textAlignLeft css-ztfl0h"/></div></h2>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n"><div class="MuiBox-root css-dm2a2d">Cache not found for input keys: <!-- --></div> といわれnpmのキャッシュ利用がなんか失敗した。<!-- --><br/>
↓記事を見る限り，キャッシュの保存に失敗してる様子<!-- --></div>
<!-- --><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-15kjgm" href="https://qiita.com/akubi0w1/items/2f4bf5d3ce7e5e77dfd7" target="_blank" rel="noopener">https://qiita.com/akubi0w1/items/2f4bf5d3ce7e5e77dfd7</a>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">あ！<!-- --><div class="MuiBox-root css-dm2a2d">actions/cache<!-- --></div>の<!-- --><div class="MuiBox-root css-dm2a2d">path<!-- --></div>が間違ってそう・・・？<!-- --></div>
<!-- --><pre><div class="MuiBox-root css-9pvfyg"><code class="hljs language-yaml">    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">uses:<!-- --></span> <!-- --><span class="hljs-string">actions/cache@v3<!-- --></span>
      <!-- --><span class="hljs-attr">id:<!-- --></span> <!-- --><span class="hljs-string">node_modules_cache_id<!-- --></span>
      <!-- --><span class="hljs-attr">env:<!-- --></span>
        <!-- --><span class="hljs-attr">cache-name:<!-- --></span> <!-- --><span class="hljs-string">cache-node-modules<!-- --></span>
      <!-- --><span class="hljs-attr">with:<!-- --></span>
        <!-- --><span class="hljs-attr">path:<!-- --></span> <!-- --><span class="hljs-string">&#x27;src/node_modules&#x27;<!-- --></span>
        <!-- --><span class="hljs-attr">key:<!-- --></span> <!-- --><span class="hljs-string">${{<!-- --></span> <!-- --><span class="hljs-string">runner.os<!-- --></span> <!-- --><span class="hljs-string">}}-build-${{<!-- --></span> <!-- --><span class="hljs-string">env.cache-name<!-- --></span> <!-- --><span class="hljs-string">}}-${{<!-- --></span> <!-- --><span class="hljs-string">hashFiles(&#x27;front/src/package-lock.json&#x27;)<!-- --></span> <!-- --><span class="hljs-string">}}<!-- --></span>
<!-- --></code></div></pre>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">正しくは，<!-- --><div class="MuiBox-root css-dm2a2d">path: front/src/node_modules<!-- --></div>かな？<!-- --><br/>
これでうまくいってくれ・・・！<!-- --></div>
<!-- --><h2 id="cache読み込めてそうだけど早くならない"><div class="MuiBox-root css-174dpmb"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-0.5 css-1xsopoz"></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-1.5 css-1chpm7x"><a class="MuiTypography-root MuiTypography-h2 MuiLink-root MuiLink-underlineHover css-haf4zu" href="/articles/7#cache%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%81%E3%81%A6%E3%81%9D%E3%81%86%E3%81%A0%E3%81%91%E3%81%A9%E6%97%A9%E3%81%8F%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84">##</a></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10 css-1v3pb4k"><div class="MuiTypography-root MuiTypography-h2 css-2hyyus">cache読み込めてそうだけど早くならない</div></div></div><hr class="MuiDivider-root MuiDivider-fullWidth MuiDivider-textAlignLeft css-ztfl0h"/></div></h2>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">cache読み込んだらインストールしないようにすべき？<!-- --><br/>
やってみる<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">-&gt; 単純にインスト―ルしないようにするとエラーになった<!-- --><br/>
cacheリストアだけだとやっぱりpipが読み込めていないぽい<!-- --><br/>
venvをcacheしてみよう。<!-- --><br/>
これならいけるやろ！<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">-&gt; ModuleNotFoundになった😢<!-- --><br/>
venvのactivateを毎回やらないとだめっぽい。<!-- --><br/>
Python実行前に毎stepでactivateしてみる。<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">-&gt; いけたっぽい<!-- --><br/>
あと，Nodeの方もうまくいってた<!-- --><br/>
こっちは<!-- --><div class="MuiBox-root css-dm2a2d">npm ci<!-- --></div>の実行をcacheの有無で制御しただけだったけど時間短縮してビルドもできてた<!-- --><br/>
あとはpipのcacheで2回目がはやくなってるかどうか<!-- --><br/>
<!-- --><br/></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">-&gt; 成功！<!-- --><br/>
合計1分程ビルド時間を短縮できた！<!-- --><br/>
2m30sから1m30sなので40%くらい時間削減できたのかな？<!-- --></div>
<!-- --><h2 id="まとめ"><div class="MuiBox-root css-174dpmb"><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-0.5 css-1xsopoz"></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-1.5 css-1chpm7x"><a class="MuiTypography-root MuiTypography-h2 MuiLink-root MuiLink-underlineHover css-haf4zu" href="/articles/7#%E3%81%BE%E3%81%A8%E3%82%81">##</a></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-10 css-1v3pb4k"><div class="MuiTypography-root MuiTypography-h2 css-2hyyus">まとめ</div></div></div><hr class="MuiDivider-root MuiDivider-fullWidth MuiDivider-textAlignLeft css-ztfl0h"/></div></h2>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n"><div class="MuiBox-root css-dm2a2d">actions/cache<!-- --></div>でpipとnpmの依存関係インストール時間を短縮した。<!-- --><br/>
pipはvenvを作成してそのenvをcacheするとうまくいった。<!-- --><br/>
npmは<!-- --><div class="MuiBox-root css-dm2a2d">node_modules<!-- --></div>をcacheするとうまくいった。<!-- --><br/>
加えてcacheするだけだと，cache読み込み後インストールを開始して結局時間が変わらなくなるので，cacheがあればインストールをしないように<!-- --><div class="MuiBox-root css-dm2a2d">if<!-- --></div>をする必要があった。<!-- --></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">↓Python部分のyaml（抜粋）<!-- --></div>
<!-- --><pre><div class="MuiBox-root css-9pvfyg"><code class="hljs language-yaml">    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">uses:<!-- --></span> <!-- --><span class="hljs-string">actions/setup-python@v4<!-- --></span>
      <!-- --><span class="hljs-attr">id:<!-- --></span> <!-- --><span class="hljs-string">setup_python_id<!-- --></span>
      <!-- --><span class="hljs-attr">with:<!-- --></span>
        <!-- --><span class="hljs-attr">python-version:<!-- --></span> <!-- --><span class="hljs-string">&#x27;3.9&#x27;<!-- --></span>

    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">uses:<!-- --></span> <!-- --><span class="hljs-string">actions/cache@v3<!-- --></span>
      <!-- --><span class="hljs-attr">id:<!-- --></span> <!-- --><span class="hljs-string">cache-venv<!-- --></span>
      <!-- --><span class="hljs-attr">with:<!-- --></span>
        <!-- --><span class="hljs-comment"># side_mはpythonプログラムのルートディレクトリ<!-- --></span>
        <!-- --><span class="hljs-attr">path:<!-- --></span> <!-- --><span class="hljs-string">side_m/.venv<!-- --></span>
        <!-- --><span class="hljs-attr">key:<!-- --></span> <!-- --><span class="hljs-string">${{<!-- --></span> <!-- --><span class="hljs-string">runner.os<!-- --></span> <!-- --><span class="hljs-string">}}-venv-${{<!-- --></span> <!-- --><span class="hljs-string">hashFiles(&#x27;side_m/requirements.txt&#x27;)<!-- --></span> <!-- --><span class="hljs-string">}}<!-- --></span>
        <!-- --><span class="hljs-attr">restore-keys:<!-- --></span> <!-- --><span class="hljs-string">|
          ${{ runner.os }}-venv-
<!-- --></span>
    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">name:<!-- --></span> <!-- --><span class="hljs-string">Create<!-- --></span> <!-- --><span class="hljs-string">venv<!-- --></span>
      <!-- --><span class="hljs-attr">if:<!-- --></span> <!-- --><span class="hljs-string">steps.cache-venv.outputs.cache-hit<!-- --></span> <!-- --><span class="hljs-type">!=<!-- --></span> <!-- --><span class="hljs-string">&#x27;true&#x27;<!-- --></span>
      <!-- --><span class="hljs-attr">run:<!-- --></span> <!-- --><span class="hljs-string">|
        cd side_m
        python -m venv .venv
        . ./.venv/bin/activate
        pip install -r requirements.txt
<!-- --></span>
    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">name:<!-- --></span> <!-- --><span class="hljs-string">Check<!-- --></span> <!-- --><span class="hljs-string">Publish<!-- --></span> <!-- --><span class="hljs-string">flag<!-- --></span>
      <!-- --><span class="hljs-attr">run:<!-- --></span> <!-- --><span class="hljs-string">|
        cd side_m
        . ./.venv/bin/activate
        python3 check.py
<!-- --></span></code></div></pre>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">↓ Next.js部分のyaml（抜粋）<!-- --></div>
<!-- --><pre><div class="MuiBox-root css-9pvfyg"><code class="hljs language-yaml">    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">name:<!-- --></span> <!-- --><span class="hljs-string">Setup<!-- --></span> <!-- --><span class="hljs-string">Node.js<!-- --></span>
      <!-- --><span class="hljs-attr">uses:<!-- --></span> <!-- --><span class="hljs-string">actions/setup-node@v3<!-- --></span>
      <!-- --><span class="hljs-attr">with:<!-- --></span>
        <!-- --><span class="hljs-attr">node-version:<!-- --></span> <!-- --><span class="hljs-number">16.<!-- --></span><span class="hljs-string">x.x<!-- --></span>

    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">uses:<!-- --></span> <!-- --><span class="hljs-string">actions/cache@v3<!-- --></span>
      <!-- --><span class="hljs-attr">id:<!-- --></span> <!-- --><span class="hljs-string">node_modules_cache_id<!-- --></span>
      <!-- --><span class="hljs-attr">env:<!-- --></span>
        <!-- --><span class="hljs-attr">cache-name:<!-- --></span> <!-- --><span class="hljs-string">cache-node-modules<!-- --></span>
      <!-- --><span class="hljs-attr">with:<!-- --></span>
        <!-- --><span class="hljs-comment"># front/src/はフロントエンドプログラムのルートディレクトリ<!-- --></span>
        <!-- --><span class="hljs-attr">path:<!-- --></span> <!-- --><span class="hljs-string">&#x27;front/src/node_modules&#x27;<!-- --></span>
        <!-- --><span class="hljs-attr">key:<!-- --></span> <!-- --><span class="hljs-string">${{<!-- --></span> <!-- --><span class="hljs-string">runner.os<!-- --></span> <!-- --><span class="hljs-string">}}-build-${{<!-- --></span> <!-- --><span class="hljs-string">env.cache-name<!-- --></span> <!-- --><span class="hljs-string">}}-${{<!-- --></span> <!-- --><span class="hljs-string">hashFiles(&#x27;front/src/package-lock.json&#x27;)<!-- --></span> <!-- --><span class="hljs-string">}}<!-- --></span>

    <!-- --><span class="hljs-bullet">-<!-- --></span> <!-- --><span class="hljs-attr">name:<!-- --></span> <!-- --><span class="hljs-string">Install<!-- --></span> <!-- --><span class="hljs-string">NPM<!-- --></span> <!-- --><span class="hljs-string">packages<!-- --></span>
      <!-- --><span class="hljs-attr">if:<!-- --></span> <!-- --><span class="hljs-string">${{<!-- --></span> <!-- --><span class="hljs-string">steps.node_modules_cache_id.outputs.cache-hit<!-- --></span> <!-- --><span class="hljs-type">!=<!-- --></span> <!-- --><span class="hljs-string">&#x27;true&#x27;<!-- --></span> <!-- --><span class="hljs-string">}}<!-- --></span>
      <!-- --><span class="hljs-attr">run:<!-- --></span> <!-- --><span class="hljs-string">npm<!-- --></span> <!-- --><span class="hljs-string">ci<!-- --></span>
      <!-- --><span class="hljs-attr">working-directory:<!-- --></span> <!-- --><span class="hljs-string">./front/src<!-- --></span>
<!-- --></code></div></pre>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">こんな感じでキャッシュしました。<!-- --><br/>
試行錯誤しながらなので他にベストプラクティスあるかもです！<!-- --></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">もっといい方法を見つけたら追記しますね<!-- --></div>
<!-- --><div class="MuiTypography-root MuiTypography-body1 css-1tnm47n">ではでは<!-- --></div></div></div></div><div><div class="MuiDivider-root MuiDivider-fullWidth MuiDivider-withChildren css-ysfq67" role="separator"><span class="MuiDivider-wrapper css-c1ovea"><h2 class="MuiTypography-root MuiTypography-h2 css-1m3ios">Related articles</h2></span></div><div class="MuiGrid-root MuiGrid-container css-1d3bbye"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 css-rpybyc"><div class="MuiBox-root css-1y8t6b0"><div class="MuiPaper-root MuiPaper-outlined MuiPaper-rounded MuiCard-root css-1npetu3"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root  css-1vffthx" tabindex="0" href="/articles/5"><div class="MuiBox-root css-y2xfrj"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg" src="https://ShotaroKataoka.github.io/static/images/thumbnail/5.jpg" alt="thumbnail"/><div class="MuiBox-root css-18m647v"><div class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom css-ich5ml">2022年06月24日 14時24分</div><div class="MuiTypography-root MuiTypography-h2 css-jezswg">汎用版RibbonCMS完成！</div></div></div></a><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiBox-root css-7ux9eu"><div class="MuiBox-root css-0"><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-qvy0nq" tabindex="0" href="/articles?tag=star">star<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-14n541y" tabindex="0" href="/articles?tag=%E9%96%8B%E7%99%BA">開発<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-5mab4u" tabindex="0" href="/articles?tag=RibbonCMS">RibbonCMS<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-1hbyurq" tabindex="0" href="/articles?tag=Next.js">Next.js<!-- --></a></div></div></div></div></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 css-rpybyc"><div class="MuiBox-root css-1y8t6b0"><div class="MuiPaper-root MuiPaper-outlined MuiPaper-rounded MuiCard-root css-1npetu3"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root  css-1vffthx" tabindex="0" href="/articles/2"><div class="MuiBox-root css-y2xfrj"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg" src="https://ShotaroKataoka.github.io/static/images/thumbnail/2.jpg" alt="thumbnail"/><div class="MuiBox-root css-18m647v"><div class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom css-ich5ml">2022年06月23日 15時02分</div><div class="MuiTypography-root MuiTypography-h2 css-jezswg">テスト投稿</div></div></div></a><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiBox-root css-7ux9eu"><div class="MuiBox-root css-0"><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-jydqma" tabindex="0" href="/articles?tag=%E6%97%A5%E8%A8%98">日記<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-5mab4u" tabindex="0" href="/articles?tag=RibbonCMS">RibbonCMS<!-- --></a></div></div></div></div></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 css-rpybyc"><div class="MuiBox-root css-1y8t6b0"><div class="MuiPaper-root MuiPaper-outlined MuiPaper-rounded MuiCard-root css-1npetu3"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root  css-1vffthx" tabindex="0" href="/articles/8"><div class="MuiBox-root css-y2xfrj"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg" src="https://ShotaroKataoka.github.io/static/images/thumbnail/8.jpg" alt="thumbnail"/><div class="MuiBox-root css-18m647v"><div class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom css-ich5ml">2022年06月28日 11時17分</div><div class="MuiTypography-root MuiTypography-h2 css-jezswg">Next.js + MUIで画面がちらつく（FOUC問題）</div></div></div></a><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiBox-root css-7ux9eu"><div class="MuiBox-root css-0"><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-14n541y" tabindex="0" href="/articles?tag=%E9%96%8B%E7%99%BA">開発<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-5mab4u" tabindex="0" href="/articles?tag=RibbonCMS">RibbonCMS<!-- --></a></div><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-1hbyurq" tabindex="0" href="/articles?tag=Next.js">Next.js<!-- --></a></div></div></div></div></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-sm-6 css-rpybyc"><div class="MuiBox-root css-1y8t6b0"><div class="MuiPaper-root MuiPaper-outlined MuiPaper-rounded MuiCard-root css-1npetu3"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root  css-1vffthx" tabindex="0" href="/articles/6"><div class="MuiBox-root css-y2xfrj"><img class="MuiCardMedia-root MuiCardMedia-media MuiCardMedia-img css-rhsghg" src="https://ShotaroKataoka.github.io/static/images/thumbnail/6.jpg" alt="thumbnail"/><div class="MuiBox-root css-18m647v"><div class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom css-ich5ml">2022年06月26日 17時43分</div><div class="MuiTypography-root MuiTypography-h2 css-jezswg">サムネイルのテスト！</div></div></div></a><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiBox-root css-7ux9eu"><div class="MuiBox-root css-0"><div class="MuiBox-root css-h50031"><a class="MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeSmall MuiButton-outlinedSizeSmall MuiButtonBase-root  css-jydqma" tabindex="0" href="/articles?tag=%E6%97%A5%E8%A8%98">日記<!-- --></a></div></div></div></div></div></div></div></div></div></div></main><footer><div class="MuiBox-root css-i51og3"><p class="MuiTypography-root MuiTypography-body2 MuiTypography-alignCenter css-dw7fc9">Copyright © <!-- --><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1c0wj8h" href="https://github.com/ShotaroKataoka" target="_blank" rel="noopener">ShotaroKataoka</a> <!-- -->2022<!-- -->.<!-- --></p></div></footer></div><div class="MuiBox-root css-175t7kh"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"7","content":"かたおかです！\nRibbonCMSではPythonとNPMを使っているのでビルド時の依存関係のインストールに時間がかかります。\n記事投稿に毎回数分かかるとめんどうなのでどうにかキャッシュできないかをテストしてみます。\n\n## ビルド時間の短縮\nGitHub ActionsでのCI/CDでは依存関係インストールがつきものです。\nPythonだと`pip`とか，フロントだと`npm`とか。\nただ，これのインストールって結構時間かかります。\n依存が大きいとインストールだけで数分とかかかってしまうので，頻繁に発動するActionsだとこれだけで大きな時間損失です。\n\u003cbr/\u003e\n\nRibbonCMSではビルドを2回行います。\nまず、Issueを`.json`ファイルなどに変換するためのビルド（Issueビルドと呼んでます）です。\nこれはPythonを用いて行っています。\n次に、Issueビルドで生成した結果をもとにしたフロント側のビルドです。\nこれによりNext.jsを用いてhtmlなどを生成しています。\n\u003cbr/\u003e\n\nこのような仕組みのため、RibbonCMSではPythonとNPMの両方のパッケージインストールを必要としています。\n記事投稿や編集のために毎回これをしているので，このインストール時間がかなりネックになってしまっている現状です。\n\n## なんか失敗する．．\n\n`Cache not found for input keys: ` といわれnpmのキャッシュ利用がなんか失敗した。\n↓記事を見る限り，キャッシュの保存に失敗してる様子\n\nhttps://qiita.com/akubi0w1/items/2f4bf5d3ce7e5e77dfd7\n\nあ！`actions/cache`の`path`が間違ってそう・・・？\n```yaml\n    - uses: actions/cache@v3\n      id: node_modules_cache_id\n      env:\n        cache-name: cache-node-modules\n      with:\n        path: 'src/node_modules'\n        key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('front/src/package-lock.json') }}\n```\n正しくは，`path: front/src/node_modules`かな？\nこれでうまくいってくれ・・・！\n\n## cache読み込めてそうだけど早くならない\ncache読み込んだらインストールしないようにすべき？\nやってみる\n\u003cbr/\u003e\n\n-\u003e 単純にインスト―ルしないようにするとエラーになった\ncacheリストアだけだとやっぱりpipが読み込めていないぽい\nvenvをcacheしてみよう。\nこれならいけるやろ！\n\u003cbr/\u003e\n\n-\u003e ModuleNotFoundになった😢\nvenvのactivateを毎回やらないとだめっぽい。\nPython実行前に毎stepでactivateしてみる。\n\u003cbr/\u003e\n\n-\u003e いけたっぽい\nあと，Nodeの方もうまくいってた\nこっちは`npm ci`の実行をcacheの有無で制御しただけだったけど時間短縮してビルドもできてた\nあとはpipのcacheで2回目がはやくなってるかどうか\n\u003cbr/\u003e\n\n-\u003e 成功！\n合計1分程ビルド時間を短縮できた！\n2m30sから1m30sなので40%くらい時間削減できたのかな？\n\n## まとめ\n`actions/cache`でpipとnpmの依存関係インストール時間を短縮した。\npipはvenvを作成してそのenvをcacheするとうまくいった。\nnpmは`node_modules`をcacheするとうまくいった。\n加えてcacheするだけだと，cache読み込み後インストールを開始して結局時間が変わらなくなるので，cacheがあればインストールをしないように`if`をする必要があった。\n\n↓Python部分のyaml（抜粋）\n```yaml\n    - uses: actions/setup-python@v4\n      id: setup_python_id\n      with:\n        python-version: '3.9'\n\n    - uses: actions/cache@v3\n      id: cache-venv\n      with:\n        # side_mはpythonプログラムのルートディレクトリ\n        path: side_m/.venv\n        key: ${{ runner.os }}-venv-${{ hashFiles('side_m/requirements.txt') }}\n        restore-keys: |\n          ${{ runner.os }}-venv-\n\n    - name: Create venv\n      if: steps.cache-venv.outputs.cache-hit != 'true'\n      run: |\n        cd side_m\n        python -m venv .venv\n        . ./.venv/bin/activate\n        pip install -r requirements.txt\n\n    - name: Check Publish flag\n      run: |\n        cd side_m\n        . ./.venv/bin/activate\n        python3 check.py\n```\n\n↓ Next.js部分のyaml（抜粋）\n```yaml\n    - name: Setup Node.js\n      uses: actions/setup-node@v3\n      with:\n        node-version: 16.x.x\n\n    - uses: actions/cache@v3\n      id: node_modules_cache_id\n      env:\n        cache-name: cache-node-modules\n      with:\n        # front/src/はフロントエンドプログラムのルートディレクトリ\n        path: 'front/src/node_modules'\n        key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('front/src/package-lock.json') }}\n\n    - name: Install NPM packages\n      if: ${{ steps.node_modules_cache_id.outputs.cache-hit != 'true' }}\n      run: npm ci\n      working-directory: ./front/src\n```\n\nこんな感じでキャッシュしました。\n試行錯誤しながらなので他にベストプラクティスあるかもです！\n\nもっといい方法を見つけたら追記しますね\n\nではでは\n","title":"GitHub Actionsでビルドを高速化したい！","posted_at":"2022年06月27日 20時43分","updated_at":"2022年06月28日 00時34分","tags":[{"name":"開発","color":"bfd4f2","description":""},{"name":"RibbonCMS","color":"fff03c","description":""}],"description":"かたおかです！ RibbonCMSではPythonとNPMを使っているのでビルド時の依存関係のインストールに時間がかかります。 記事投稿に毎回数分かかるとめんどうなのでどうにかキャッシュできないかをテストしてみます。  ## ビルド時間の短縮 GitHub ActionsでのCI/CDでは依存関係インストールがつきものです。 Pythonだと`pip`とか，フロントだと`npm`とか。 ただ，これ..."},"config":{"blog_title":"かたおかの雑談配信","site_introduction":"かたおかのブログです。主に趣味関係をだらだら書いていきます。日本文化が好きです。","copylight_name":"ShotaroKataoka","copylight_url":"https://github.com/ShotaroKataoka","issues_page_url":"https://github.com/ShotaroKataoka/ShotaroKataoka.github.io/issues","favicon_image_url":"https://user-images.githubusercontent.com/42331656/175220729-c255f8b0-e709-4efc-a8e6-dc2e29a92c35.png","author_name":"かたおか","author_introduction":"かたおかです。アイコンはみかん。","avatar_image_url":{"url":"https://user-images.githubusercontent.com/42331656/175183205-06dc6033-af20-44b9-ae3d-c3e68770a1f3.png","path":"/static/images/config/avatar.webp"},"sns":[{"name":"GitHub","url":"https://github.com/ShotaroKataoka"},{"name":"Twitter","url":"https://twitter.com/KataokaShotaro"},{"name":"Facebook","url":"https://www.facebook.com/profile.php?id=100014221270440"},{"name":"LinkedIn","url":"https://www.linkedin.com/in/shotarokataoka/"},{"name":"Instagram","url":"https://www.instagram.com/s.kataoka_/?hl=ja"}]},"postsMap":{"2":{"slug":"2","title":"テスト投稿","tags":[{"name":"日記","color":"006b75","description":""},{"name":"RibbonCMS","color":"fff03c","description":""}],"posted_at":"2022年06月23日 15時02分","content":"","updated_at":"","description":""},"5":{"slug":"5","title":"汎用版RibbonCMS完成！","tags":[{"name":"star","color":"fbca04","description":""},{"name":"開発","color":"bfd4f2","description":""},{"name":"RibbonCMS","color":"fff03c","description":""},{"name":"Next.js","color":"E63EC8","description":""}],"posted_at":"2022年06月24日 14時24分","content":"","updated_at":"","description":""},"6":{"slug":"6","title":"サムネイルのテスト！","tags":[{"name":"日記","color":"006b75","description":""}],"posted_at":"2022年06月26日 17時43分","content":"","updated_at":"","description":""},"8":{"slug":"8","title":"Next.js + MUIで画面がちらつく（FOUC問題）","tags":[{"name":"開発","color":"bfd4f2","description":""},{"name":"RibbonCMS","color":"fff03c","description":""},{"name":"Next.js","color":"E63EC8","description":""}],"posted_at":"2022年06月28日 11時17分","content":"","updated_at":"","description":""}},"metadata":{"https://qiita.com/akubi0w1/items/2f4bf5d3ce7e5e77dfd7":{"url_domain":"qiita.com","url_domain_link":"https://qiita.com","title":"GitHub Actionsのcacheでどハマりした - Qiita","description":"\n\nはじめに\n\nタイトルそのままのことがおこりました。\n\n4/15追記: 今回ハマったこと自体は、原因がわかり、形的に成功しているように見えるのですが、8割解決してないです。\nこちらも合わせてどうぞ...。\nGitHub Action...","image_url":"/static/images/external_ogp//f6c4804976e9c023caa6f5e40aa4d283.webp","site_name":"Qiita"}},"relatedPosts":[{"slug":"5","title":"汎用版RibbonCMS完成！","tags":[{"name":"star","color":"fbca04","description":""},{"name":"開発","color":"bfd4f2","description":""},{"name":"RibbonCMS","color":"fff03c","description":""},{"name":"Next.js","color":"E63EC8","description":""}],"posted_at":"2022年06月24日 14時24分","content":"","updated_at":"","description":""},{"slug":"2","title":"テスト投稿","tags":[{"name":"日記","color":"006b75","description":""},{"name":"RibbonCMS","color":"fff03c","description":""}],"posted_at":"2022年06月23日 15時02分","content":"","updated_at":"","description":""},{"slug":"8","title":"Next.js + MUIで画面がちらつく（FOUC問題）","tags":[{"name":"開発","color":"bfd4f2","description":""},{"name":"RibbonCMS","color":"fff03c","description":""},{"name":"Next.js","color":"E63EC8","description":""}],"posted_at":"2022年06月28日 11時17分","content":"","updated_at":"","description":""},{"slug":"6","title":"サムネイルのテスト！","tags":[{"name":"日記","color":"006b75","description":""}],"posted_at":"2022年06月26日 17時43分","content":"","updated_at":"","description":""}]},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"7"},"buildId":"57i90bc2xhNF_uFT2ZN-C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>